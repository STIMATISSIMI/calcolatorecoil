function calcolaCoil() {
    var wireDiameter = parseFloat(document.getElementById("wireDiameter").value); // mm
    var coilDiameter = parseFloat(document.getElementById("coilDiameter").value); // mm
    var numSpire = parseFloat(document.getElementById("numSpire").value);
    var legLength = parseFloat(document.getElementById("legLength").value); // mm per gamba
    var corrFactor = parseFloat(document.getElementById("corrFactor").value) / 100; // es. 10% = 0.10
    var wattaggio = parseFloat(document.getElementById("wattaggio").value); // Wattaggio della coil

    // Selezione del materiale
    var materialKey = document.getElementById("wireMaterial").value;
    var material = materials[materialKey];

    // Aggiorna i dati sul materiale selezionato nell'output
    document.getElementById("materialSelected").textContent = material.name;
    document.getElementById("tcrValue").textContent = material.tcr;

    // Resistività per il materiale selezionato (in &#937;·mm²/m)
    var resistivity = material.resistivity;

    // Calcolo della lunghezza totale del filo:
    var totalLength = numSpire * Math.PI * (coilDiameter + wireDiameter) + 2 * legLength; // mm

    var radius = wireDiameter / 2;
    var areaCrossSection = Math.PI * Math.pow(radius, 2); // mm²

    // Calcolo della resistenza teorica:
    var R_theoretical = (resistivity * (totalLength / 1000)) / areaCrossSection; // &#937;

    // Applichiamo la correzione:
    var R_corrected = R_theoretical * (1 + corrFactor);

    // Calcolo dell'erogazione
    var erogazioneFull = Math.pow(4.2, 2) / R_corrected; // W
    var erogazioneDrop = Math.pow(3.8, 2) / R_corrected; // W
    var erogazioneHalf = Math.pow(3.7, 2) / R_corrected; // W

    // Calcolo dell'Heat Flux basato sul wattaggio inserito:
    var areaSurface = Math.PI * coilDiameter * totalLength / 1000; // mm²
    var heatFlux = wattaggio / areaSurface; // mW/mm²

    // Mostra risultati
    document.getElementById("wireLength").textContent = totalLength.toFixed(2);
    document.getElementById("resTeorica").textContent = R_theoretical.toFixed(2);
    document.getElementById("resCorretta").textContent = R_corrected.toFixed(2);
    document.getElementById("erogazione_full").textContent = erogazioneFull.toFixed(2);
    document.getElementById("erogazione_drop").textContent = erogazioneDrop.toFixed(2);
    document.getElementById("erogazione_half").textContent = erogazioneHalf.toFixed(2);
    document.getElementById("heatFlux").textContent = (heatFlux * 1000).toFixed(2); // Convert to mW/mm²
}
